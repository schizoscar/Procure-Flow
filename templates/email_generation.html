<!-- templates/email_generation.html -->
{% extends "base.html" %}

{% block content %}
<div class="card-white">
    <div class="card-header">
        <h2>Generate Email Content</h2>
        <p>Step 3: Customize email content for {{ task.task_name }}</p>
    </div>
    <div class="card-body bg-light">
        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="progress-step completed">1</div>
            <div class="progress-step completed">2</div>
            <div class="progress-step active">3</div>
            <div class="progress-step">4</div>
        </div>

        <!-- Email Templates Overview -->
        <div class="card mb-4">
            <div class="card-header">
                <h4><i class="fas fa-envelope"></i> Email Templates Overview</h4>
            </div>
            <div class="card-body bg-light">
                <p>Based on your supplier assignments, we've created <strong>{{ email_templates|length }}</strong> unique email template(s):</p>
                
                <div class="email-templates-overview">
                    {% for template_key, template in email_templates.items() %}
                    <div class="template-card">
                        <div class="template-header">
                            <h5>Template {{ loop.index }}</h5>
                            <span class="badge">{{ template.suppliers|length }} supplier(s)</span>
                        </div>
                        <div class="template-details">
                            <p><strong>Items included:</strong> 
                                {% if template_key == 'all' %}
                                All items
                                {% else %}
                                {{ template.items|length }} specific item(s)
                                {% endif %}
                            </p>
                            <p><strong>Recipients:</strong></p>
                            <ul class="supplier-list">
                                {% for supplier in template.suppliers %}
                                <li>{{ supplier.name }} ({{ supplier.email }})</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Email Content Editor -->
        <form method="POST">
            <div class="card-white">
                <div class="card-header">
                    <h4><i class="fas fa-edit"></i> Edit Email Content</h4>
                </div>
                <div class="card-body bg-light">
                    <div class="form-group">
                        <label class="form-label">Email Template (All templates use the same content)</label>
                        <p class="text-muted mb-3">
                            <small>
                                <i class="fas fa-info-circle"></i> 
                                Use <code>{supplier_name}</code> to automatically insert the supplier's name. 
                                All suppliers will receive emails with the same content but filtered for their assigned items.
                            </small>
                        </p>
                        <textarea class="form-control" name="email_content" rows="20" required>{{ default_email_content }}</textarea>
                    </div>

                    <div class="email-preview-card">
                        <h5><i class="fas fa-eye"></i> Quick Preview</h5>
                        <div class="preview-content">
                            <div class="preview-header">
                                <strong>Subject:</strong> Procurement Inquiry - {{ task.task_name }}
                            </div>
                            <div class="preview-body">
                                <p><strong>To:</strong> Supplier Name</p>
                                <p><strong>Content:</strong> (Will be generated from your template above)</p>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-1 mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-eye"></i> Preview All Emails
                        </button>
                        <a href="{{ url_for('supplier_selection', task_id=task.id) }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Supplier Selection
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.email-templates-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.template-card {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1rem;
    background: #f8f9fa;
}

.template-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #dee2e6;
}

.template-header h5 {
    margin: 0;
    color: var(--hercules-blue);
}

.badge {
    background: var(--hercules-blue);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.8rem;
}

.supplier-list {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
    font-size: 0.9rem;
}

.supplier-list li {
    margin-bottom: 0.25rem;
}

.email-preview-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.preview-content {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 1rem;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.preview-header {
    padding-bottom: 0.5rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #e9ecef;
    color: var(--hercules-blue);
}

.preview-body {
    color: #666;
}

textarea.form-control {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}
</style>
{% endblock %}
